{% extends "./base.html" %}
{% load static %}
{% block content %}

<!-- page head section starts -->
     {% include "./profile-head.html" %}
    <!-- page head section end -->

    <!-- profile section starts -->
    <section class="profile-section section-b-space">
        <div class="container">
            <div class="row g-3">
                <div class="col-lg-3">
                        {% include "./profile-sidebar.html" %}
                </div>
                <div class="col-lg-9">
                    <div class="my-order-content">
                        {% include "./messages.html" %}
                        <div class="title">
                            <div class="loader-line"></div>
                            <h3>My Order</h3>
                        </div>
                        <p>Wallet Balance: {{wallet_balance}}</p>
                        <div class="sorting d-flex justify-content-end">
                            <p class="p-2">Sort By</p>
                            <p class="p-2"><a href="?sort=delivery_date&dir={% if sort == 'delivery_date' and dir == 'asc' %}desc{% else %}asc{% endif %}">Delivery Date</a></p>
                            <p class="p-2"><a href="?sort=status&dir={% if sort == 'status' and dir == 'asc' %}desc{% else %}asc{% endif %}">Status</a></p>
                        </div>
                        <ul class="order-box-list">
                            {% for order in orders%}
                            <li>
                                <div class="order-box">
                                    <div class="order-box-content">
                                        <div class="brand-icon">
                                            <img class="img-fluid icon" src="{{order.restaurant.restaurant_image.url}}" alt="Restaurant Logo">
                                        </div>
                                        <div class="order-details">
                                            <div class="d-flex align-items-center justify-content-between w-100">
                                                <h5 class="brand-name dark-text fw-medium">
                                                    {{order.restaurant.restaurant_name}}
                                                </h5>
                                                <h6 class="fw-medium content-color text-end">
                                                    {{order.delivery_date}}
                                                </h6>
                                            </div>
                                            <h6 class="fw-medium dark-text">
                                                <span class="fw-normal content-color">Order Id: {{order.id}}
                                                </span>
                                            </h6>
                                            <h6 class="fw-medium dark-text">
                                                <span class="fw-normal content-color">{{order.food_category.name}}
                                                </span>
                                            </h6>
                                            <h6 class="fw-medium dark-text">
                                                <span class="fw-normal content-color">Status: {{order.status}}
                                                </span>
                                            </h6>
                                            <h6 class="fw-medium dark-text">
                                                <span class="fw-normal content-color">Cancellation time: {{order.food_category.cancellation_time}}
                                                </span>
                                            </h6>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between mt-sm-3 mt-2">
                                        <h6 class="fw-medium dark-text">
                                            <span class="fw-normal content-color">Total Amount :</span>
                                            Rs. {{order.food_category.price}}
                                        </h6>
                                        {% if order.status == 'PENDING'%}
                                        <a href="#cancel_order" class="btn theme-outline details-btn"
                                            data-bs-toggle="modal" data-orderid="{{order.id}}">Cancel</a>
                                        {%else%}
                                        <button  class="btn theme-outline details-btn">{{order.status}}</button>
                                        {%endif%}
                                    </div>
                                </div>
                            </li>

                            <!-- No order found -->
                            {% empty %}

                            <li>
                                <div class="order-box">
                                    <div class="order-box-content">
                                        <div class="brand-icon">
                                        </div>
                                        <div class="order-details">
                                            <div class="d-flex align-items-center justify-content-between w-100">
                                            <h6 class="fw-medium dark-text">
                                                <span class="fw-normal content-color">No orders found
                                                </span>
                                            </h6>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            {%endfor%}

                        </ul>

                        <!-- Pagination Controls -->
                        {% include "./paginator.html" %}







                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- profile section end -->


    <!-- logout modal starts -->
    <div class="modal address-details-modal fade" id="cancel_order" tabindex="-1" aria-labelledby="login-out"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="login-out">Cancel Order</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Choose one option</p>
                </div>
                <div class="modal-footer">
                    <a href="#" id="refund" class="btn gray-btn me-2 mt-0" data-bs-dismiss="modal">Refund to Wallet</a>
                    <a href="#" id="extend" class="btn gray-btn me-2 mt-0" data-bs-dismiss="modal">Extend subscription</a>
                </div>
            </div>
        </div>
    </div>
    <!-- logout modal end -->

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const myModal = document.getElementById('cancel_order');

    if (myModal) {
      myModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget; // Button that triggered the modal
        const orderId = button.getAttribute('data-orderid');

        const refund = document.getElementById("refund");
        const extend = document.getElementById("extend");

        if (refund) {
          // Remove previous listeners if any
          refund.replaceWith(refund.cloneNode(true));
          const newRefund = document.getElementById("refund");

          newRefund.addEventListener('click', function () {
            console.log("User asked for refund");
            window.location.href = `cancel/${orderId}`;  // Use correct URL format
          });
        }

        if (extend) {
          extend.replaceWith(extend.cloneNode(true));
          const newExtend = document.getElementById("extend");

          newExtend.addEventListener('click', function () {
            console.log("User asked for extension");
            window.location.href = `extend/${orderId}`;  // Use correct URL format

          });
        }
      });
    }
  });
</script>

{%endblock%}