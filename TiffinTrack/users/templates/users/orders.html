{% extends "./base.html" %}
{% load static %}
{% block content %}

<!-- page head section starts -->
     {% include "./profile-head.html" %}
    <!-- page head section end -->

    <!-- profile section starts -->
    <section class="profile-section section-b-space">
        <div class="container">
            <div class="row g-3">
                <div class="col-lg-3">
                        {% include "./profile-sidebar.html" %}
                </div>
                <div class="col-lg-9">
                    <div class="my-order-content">
                        {% include "./messages.html" %}
                        <div class="title">
                            <div class="loader-line"></div>
                            <h3>My Order</h3>
                        </div>
                        <p>Wallet Balance: {{wallet_balance}}</p>
                        <div class="sorting d-flex justify-content-end">
                            <p class="p-2">Sort By</p>
                            <p class="p-2"><a href="?sort=delivery_date&dir={% if sort == 'delivery_date' and dir == 'asc' %}desc{% else %}asc{% endif %}">Delivery Date</a></p>
                            <p class="p-2"><a href="?sort=status&dir={% if sort == 'status' and dir == 'asc' %}desc{% else %}asc{% endif %}">Status</a></p>
                        </div>
                        <ul class="order-box-list">
                            {% for order in orders%}
                            <li>
                                <div class="order-box">
                                    <div class="order-box-content">
                                        <div class="brand-icon">
                                        </div>
                                        <div class="order-details">
                                            <div class="d-flex align-items-center justify-content-between w-100">
                                                <h5 class="brand-name dark-text fw-medium">
                                                    {{order.restaurant.restaurant_name}}
                                                </h5>
                                                <h6 class="fw-medium content-color text-end">
                                                    {{order.delivery_date}}
                                                </h6>
                                            </div>
                                            <h6 class="fw-medium dark-text">
                                                <span class="fw-normal content-color">Order Id: {{order.id}}
                                                </span>
                                            </h6>
                                            <h6 class="fw-medium dark-text">
                                                <span class="fw-normal content-color">{{order.food_category.name}} - {{order.food_item.name}}
                                                </span>
                                            </h6>
                                            <h6 class="fw-medium dark-text">
                                                <span class="fw-normal content-color">Status: {{order.status}}
                                                </span>
                                            </h6>
                                            <h6 class="fw-medium dark-text">
                                                <span class="fw-normal content-color">Cancellation time: {{order.food_category.cancellation_time}}
                                                </span>
                                            </h6>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between mt-sm-3 mt-2">
                                        <h6 class="fw-medium dark-text">
                                            <span class="fw-normal content-color">Total Amount :</span>
                                            Rs. {{order.food_category.price}}
                                        </h6>
                                        {% if order.status == 'PENDING'%}
                                        <form method="post" action="{% url 'cancel_order' order.id %}">
                                            {%csrf_token%}
                                        <button type="submit" class="btn theme-outline details-btn">Cancel</button>
                                        </form>
                                        {%else%}
                                        <button  class="btn theme-outline details-btn">{{order.status}}</button>
                                        {%endif%}
                                    </div>
                                </div>
                            </li>

                            <!-- No order found -->
                            {% empty %}

                            <li>
                                <div class="order-box">
                                    <div class="order-box-content">
                                        <div class="brand-icon">
                                        </div>
                                        <div class="order-details">
                                            <div class="d-flex align-items-center justify-content-between w-100">
                                            <h6 class="fw-medium dark-text">
                                                <span class="fw-normal content-color">CNo orders found
                                                </span>
                                            </h6>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            {%endfor%}

                        </ul>

                        <!-- Pagination Controls -->
                        <div class=" pagination p-4">
                        <span class="step-links">
                            {% if orders.has_previous %}
                            <a href="?page=1" class="p-2">&laquo; first</a>
                            <a href="?page={{ orders.previous_page_number }}" class="p-2">previous</a>
                            {% endif %}

                            <span class="current p-2">
                            Page {{ orders.number }} of {{ orders.paginator.num_pages }}
                            </span>

                            {% if orders.has_next %}
                            <a href="?page={{ orders.next_page_number }}" class="p-2">next</a>
                            <a href="?page={{ orders.paginator.num_pages }}" class="p-2">last &raquo;</a>
                            {% endif %}
                        </span>
                        </div>







                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- profile section end -->

{%endblock%}