{% extends "./base.html" %}
{% load static %}
{% block content %}


    <!-- page head section starts -->
    <section class="page-head-section">
        <div class="container page-heading">
            <h2 class="h3 mb-3 text-white text-center">Payment</h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb flex-lg-nowrap justify-content-center justify-content-lg-star">
                    <li class="breadcrumb-item">
                        <a href="{% url 'user-home' %}"><i class="ri-home-line"></i>Home</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">Payment</li>
                </ol>
            </nav>
        </div>
    </section>
    <!-- page head section end -->

<!-- account section starts -->
<section class="account-section section-b-space pt-0">
    <div class="container">
        <div class="layout-sec">
            <div class="row justify-content-center">
                <div class="col-lg-8 col-xl-6">
                    <div class="order-summery-section">
                        <div class="checkout-detail">
                            <!-- Delivery Address -->
                            <div class="cart-address-box">
                                <div class="add-img">
                                    <img class="img-fluid img" src="{% static 'frontend/assets/images/home.png' %}" alt="home">
                                </div>
                                <div class="add-content">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <h5 class="dark-text deliver-place">
                                            Deliver to: {{subscription.address.address_line}}
                                        </h5>
                                    </div>
                                </div>
                            </div>

                            <!-- Order Summary Title -->
                            <h3 class="fw-semibold dark-text checkout-title">Order Summary</h3>



                            <!-- Bill Details -->

                            <div class="bill-details mb-4">
                                <div class="sub-total">
                                    <h6 class="content-color fw-normal">Selected Menu</h6>
                                    <h6 class="fw-semibold">{{subscription.menu_category.name}}</h6>
                                </div>
                                <div class="sub-total">
                                    <h6 class="content-color fw-normal">Restaurant</h6>
                                    <h6 class="fw-semibold">{{subscription.num_days}}</h6>
                                </div>
                                <div class="sub-total">
                                    <h6 class="content-color fw-normal">Start Date</h6>
                                    <h6 class="fw-semibold">{{subscription.num_days}}</h6>
                                </div>
                                <div class="sub-total">
                                    <h6 class="content-color fw-normal">End Date</h6>
                                    <h6 class="fw-semibold">{{subscription.num_days}}</h6>
                                </div>
                                <div class="sub-total">
                                    <h6 class="content-color fw-normal">Number of Days</h6>
                                    <h6 class="fw-semibold">{{subscription.num_days}}</h6>
                                </div>
                                <div class="sub-total">
                                    <h6 class="content-color fw-normal">Per Day Price</h6>
                                    <h6 class="fw-semibold">Rs.{{subscription.per_day_amount}}</h6>
                                </div>
                                <div class="sub-total">
                                    <h6 class="content-color fw-normal">Sub Total</h6>
                                    <h6 class="fw-semibold">Rs.{{subscription.total_amount}}</h6>
                                </div>

                            <!-- Wallet Payment Option -->
                            <div class="payment-section mt-0 p-0">
                                <div class="wallet-option p-3 border rounded">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="use_wallet" id="use_wallet">
<label class="form-check-label fw-medium" for="use_wallet" id="wallet_label">
    Use wallet amount: Rs.{{ wallet_amount }}
</label>

                                    </div>
                                </div>
                            </div>

                            <!-- Promo Code -->
                            <div class="promo-code position-relative mb-4">
                                <input type="text" class="form-control code-form-control" placeholder="Enter promo code">
                                <a href="#" class="btn theme-btn apply-btn mt-0">APPLY</a>
                            </div>

                                <hr>
                                <div class="grand-total">
                                    <h6 class="fw-bold dark-text">Total Amount</h6>
                                    <h6 class="fw-bold amount" id="total_amount_display">Rs. {{subscription.total_amount}}</h6>
                                </div>
                            </div>

                            <!-- Payment Form -->
                            <form method="post" id="payment">
                                {% csrf_token %}
                                <input type="hidden" name="paid_amount" value="{{subscription.total_amount}}">
                                <input type="hidden" id="wallet_amount" name="wallet_amount" value="">
                                <button type="submit" id="payment_confirm" class="btn theme-btn restaurant-btn w-100 rounded-2">
                                    Proceed to Payment
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- account section end -->

<script>
    const originalAmount = {{ subscription.total_amount }};
    const walletAmount = {{ wallet_amount }};

    const checkbox = document.getElementById("use_wallet");
    const amountDisplay = document.getElementById("total_amount_display");
    const hiddenWalletInput = document.getElementById("wallet_amount");
    const walletLabel = document.getElementById("wallet_label");

    checkbox.addEventListener("change", function () {
        if (checkbox.checked) {
            const walletUsed = Math.min(walletAmount, originalAmount);
            const newAmount = originalAmount - walletUsed;

            amountDisplay.textContent = `Rs.${newAmount}`;
            hiddenWalletInput.value = walletUsed;
            walletLabel.textContent = `Wallet used: Rs.${walletUsed}, Remaining: Rs.${walletAmount - walletUsed}`;
        } else {
            amountDisplay.textContent = `Rs.${originalAmount}`;
            hiddenWalletInput.value = 0;
            walletLabel.textContent = `Use wallet amount: Rs.${walletAmount}`;
        }
    });
</script>



{%endblock%}